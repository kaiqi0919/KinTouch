# 出退勤管理システム

カードリーダーを使用した講師向け出退勤管理システムです。

## 機能

- **講師登録**: カードUIDと講師名を紐付けて登録
- **出退勤監視**: カードをかざすだけで自動的に出勤/退勤を記録
- **記録管理**: SQLiteデータベースで打刻時刻を管理
- **履歴表示**: 今日の打刻記録や登録済み講師の一覧表示

## 必要な環境

- Python 3.x
- カードリーダー（FeliCa対応）
- ICカード（FeliCa/MIFARE等）

## インストール

```bash
pip install pyscard
```

## 使用方法

### 1. システム起動

```bash
python attendance_system.py
```

### 2. 初回設定（講師登録）

1. メニューから「2. 講師登録」を選択
2. カードをリーダーにかざす
3. 講師名を入力
4. 登録完了

### 3. 出退勤監視

1. メニューから「1. 出退勤監視開始」を選択
2. 講師がカードをかざすと自動的に出勤/退勤を記録
3. Ctrl+Cで監視終了

### 4. 記録確認

- **講師一覧**: メニュー「3. 講師一覧表示」
- **今日の記録**: メニュー「4. 今日の打刻記録表示」

## データベース構造

### instructors テーブル（講師マスタ）
- `id`: 講師ID（主キー）
- `card_uid`: カードUID（ユニーク）
- `name`: 講師名
- `created_at`: 登録日時

### time_records テーブル（打刻時刻）
- `id`: 記録ID（主キー）
- `instructor_id`: 講師ID（外部キー）
- `card_uid`: カードUID
- `record_type`: 記録種別（'IN': 出勤, 'OUT': 退勤）
- `timestamp`: 打刻日時

## 出退勤判定ロジック

- 最後の記録が「退勤」または記録がない場合 → 「出勤」として記録
- 最後の記録が「出勤」の場合 → 「退勤」として記録

## ファイル構成

- `attendance_system.py`: メインプログラム
- `attendance.db`: SQLiteデータベース（自動作成）
- `KinTouch.py`: 元のカード監視スクリプト（参考用）

## 注意事項

- カードリーダーが正しく接続されていることを確認してください
- 同じカードを短時間で連続してかざしても重複記録されません
- データベースファイル（attendance.db）は自動的に作成されます

## トラブルシューティング

### カードリーダーが認識されない
- デバイスマネージャーでドライバーを確認
- カードリーダーの接続を確認

### カードが読み取れない
- カードがリーダーに正しく置かれているか確認
- カードの種類がサポートされているか確認

### データベースエラー
- attendance.dbファイルの権限を確認
- ディスク容量を確認

# 出退勤管理システム（CSV版）

講師マスタをCSVファイルで管理する出退勤管理システムです。

## 特徴

- **講師マスタ**: CSVファイル（`instructors.csv`）で管理 → **可視性が高く、直接編集可能**
- **打刻記録**: SQLiteデータベースで管理 → 高速検索・集計が可能
- **ハイブリッド構成**: 管理しやすさと性能を両立

## ファイル構成

```
KinTouch/
├── attendance_system_csv.py    # メインプログラム（CSV版）
├── instructors.csv             # 講師マスタ（自動作成）
├── attendance.db              # 打刻記録データベース（自動作成）
├── .gitignore                  # Git除外設定
├── log/                        # CSVエクスポートファイル保存先（自動作成）
│   ├── attendance_records_2025-09-19.csv
│   ├── attendance_records_2025-09-19_2.csv
│   └── attendance_records_2025-08-29.csv
└── README.md                   # このファイル
```

## 使用方法

### 1. システム起動

```bash
python attendance_system_csv.py
```

### 2. 講師マスタの管理

#### 方法1: システム内で登録
1. メニューから「2. 講師登録」を選択
2. カードをリーダーにかざす
3. 講師名を入力

#### 方法2: CSVファイルを直接編集
`instructors.csv`ファイルを直接編集できます：

```csv
card_uid,name,created_at
04 12 34 56 78 9A BC,田中太郎,2025-01-29 15:30:00
04 AB CD EF 12 34 56,佐藤花子,2025-01-29 15:31:00
04 98 76 54 32 10 FE,鈴木一郎,2025-01-29 15:32:00
```

### 3. 出退勤監視

1. メニューから「1. 出退勤監視開始」を選択
2. 講師がカードをかざすと自動的に出勤/退勤を記録
3. Ctrl+Cで監視終了

### 4. 記録確認

- **講師一覧**: メニュー「3. 講師一覧表示」
- **今日の記録**: メニュー「4. 今日の打刻記録表示」
- **今日のサマリー**: メニュー「5. 今日の出退勤状況サマリー」
- **特定日付の記録**: メニュー「6. 特定の日付の打刻記録表示」
- **特定日付のサマリー**: メニュー「7. 特定の日付の出退勤状況サマリー」
- **CSVファイル確認**: メニュー「8. 講師マスタCSVファイル確認」

### 5. CSVエクスポート機能

打刻記録をCSVファイルとしてエクスポートできます：

- **今日の記録をエクスポート**: メニュー「10. 今日の打刻記録をCSVエクスポート」
- **特定日付の記録をエクスポート**: メニュー「11. 特定の日付の打刻記録をCSVエクスポート」

#### エクスポート機能の特徴
- **保存先**: `log/`ディレクトリに自動保存
- **ファイル名**: `attendance_records_YYYY-MM-DD.csv`形式
- **重複回避**: 同じ日付で複数回エクスポートしても連番付きで保存
- **Excel対応**: UTF-8 BOM付きで日本語が正しく表示
- **Git除外**: `.gitignore`により個人情報保護

#### エクスポートされるCSVの形式
```csv
講師名,打刻種別,打刻日時,カードUID
田中太郎,出勤,2025-09-19 09:00:15,04 12 34 56 78 9A BC
田中太郎,退勤,2025-09-19 18:30:22,04 12 34 56 78 9A BC
佐藤花子,出勤,2025-09-19 09:15:33,04 AB CD EF 12 34 56
```

## データ構造

### instructors.csv（講師マスタ）
```csv
card_uid,name,created_at
カードUID,講師名,登録日時
```

### time_records テーブル（打刻記録）
- `id`: 記録ID（主キー）
- `card_uid`: カードUID
- `instructor_name`: 講師名
- `record_type`: 記録種別（'IN': 出勤, 'OUT': 退勤）
- `timestamp`: 打刻日時

## CSV版の利点

### 1. 可視性の向上
- **直接確認**: テキストエディタやExcelで直接開ける
- **一覧性**: 全講師を一目で確認可能
- **検索**: Ctrl+Fで簡単に講師を検索

### 2. 管理の簡単さ
- **直接編集**: システムを停止せずに講師情報を編集
- **バックアップ**: ファイルコピーで簡単にバックアップ
- **移行**: 他のシステムとの連携が容易

### 3. トラブル対応
- **データ確認**: 問題発生時にすぐにデータを確認
- **手動修正**: 必要に応じて手動でデータを修正
- **復旧**: バックアップファイルからの復旧が簡単

## 運用のベストプラクティス

### 1. 定期バックアップ
```bash
# 講師マスタのバックアップ
copy instructors.csv instructors_backup_20250129.csv

# データベースのバックアップ
copy attendance.db attendance_backup_20250129.db
```

### 2. CSVファイル編集時の注意
- **文字エンコーディング**: UTF-8で保存
- **ヘッダー行**: 削除しない
- **カンマ区切り**: 講師名にカンマを含めない
- **重複チェック**: 同じcard_uidを重複させない

### 3. 講師の追加・削除
- **追加**: CSVファイルの最後に新しい行を追加
- **削除**: 該当行を削除（過去の打刻記録は残る）
- **変更**: 講師名の変更は可能（card_uidは変更しない）

## トラブルシューティング

### CSVファイルが破損した場合
1. システムを停止
2. バックアップファイルから復旧
3. システムを再起動

### 講師が認識されない場合
1. `instructors.csv`でcard_uidを確認
2. カードリーダーでUIDを再確認
3. 必要に応じてCSVファイルを修正

### データベースエラーの場合
- 打刻記録のみ影響（講師マスタは安全）
- `attendance.db`を削除して再作成可能

## 従来版との比較

| 項目 | CSV版 | 従来版（SQLite） |
|------|-------|------------------|
| 講師マスタ | CSVファイル | SQLiteテーブル |
| 可視性 | ★★★ | ★ |
| 編集の簡単さ | ★★★ | ★ |
| 検索性能 | ★ | ★★★ |
| データ整合性 | ★★ | ★★★ |
| バックアップ | ★★★ | ★★ |

CSV版は**管理の簡単さと可視性を重視**した設計です。
